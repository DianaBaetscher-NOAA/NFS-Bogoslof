---
title: "R Notebook"
output: github_document
---

August 2023 - Bogoslof SeaBird Temperature/Pressure casts

Quick look at SeaBird cast data from field collections, August 6-11.


```{r load-libraries}
library(tidyverse)
```
## Notes and to-dos

Need to convert pressure to depth

Need to change UTC to AK time to determine dates/times for each sampling event (1-5).


Eddy field around Bogoslof - Jeremy could pull down the remote sensing data - additional foraging corresponding to eddies

Monthly composite of chlorophyll for August

Argo float - subsurface current field

Ask PMEL if there is any data for this time period

Climate modelers at UW/PMEL Al Herman and Wei, running the models and running the bias correction.



### Confirm that I have all the CTD data onboard.

```{r read-in-all-data}
cumulative_dat <- read_csv("../data/SBE39plus09899_2023-09-12.asc", skip = 11, col_names = F) %>%
  rename(temperature = X1, pressure = X2, date = X3, time = X4) %>%
  separate(date, into = c("day", "month", "year")) %>%
  filter(month != "Jul") # remove test data prior to Bogoslof

cumulative_dat %>%
  group_by(day, month) %>%
  tally() 
```



```{r}
cumulative_dat %>%
 filter(day %in% c(10, 11)) %>%
  ggplot(aes(x = time, y = pressure)) +
  geom_point()


```

That looks like a pretty consistent signal on pressure/depth.



```{r plot-casts-example}
# for one sampling period
cumulative_dat %>%
  filter(day %in% c(10, 11)) %>%
  filter(pressure != 0) %>%
  filter(temperature < 10) %>%
  ggplot(aes(x = temperature, y = -1*pressure)) +
  geom_point() + 
  labs(x = "temperature C",
       y = "pressure dbar*-1")


```

Convert between UTC and AK time by subtracting 8 hours.

## Conversion of pressure to depth

According to the SeaBird Application Note No. 69:

Seawater Applications

Sea-Bird uses the formula in UNESCO Technical Papers in Marine Science No. 44. This is an
empirical formula that takes compressibility (that is, density) into account. An ocean water column
at 0 °C (t = 0) and 35 PSU (s = 35) is assumed.

The gravity variation with latitude and pressure is computed as:
g (m/sec2) = 9.780318 * [ 1.0 + ( 5.2788x10 -3 + 2.36x10 -5 * x) * x ] + 1.092x10 -6 * p

where
x = [sin (latitude / 57.29578) ] 2
p = pressure (decibars)

Then, depth is calculated from pressure:
depth (meters) = [(((-1.82x10 -15 * p + 2.279x10 -10 ) * p - 2.2512x10 -5 ) * p + 9.72659) * p] / g
where
p = pressure (decibars)
g = gravity (m/sec2) 


the lat/lon for Bogoslof is:
53.9280° N, 168.0381° W

```{r formula-to-convert-pressure-to-depth}
# beginning with just latitude and pressure

depth_conversion <- function(latitude, p) {

    # latitude influence
    x <- (sin (latitude / 57.29578) )^2
    
    # gravity variation wtih latitude and pressure
    g <- 9.780318 * ( 1.0 + ( 5.2788*10^(-3) + 2.36*10^-5 * x) * x ) + 1.092*10^-6 * p
    
    # depth
    depth_m <- ((((-1.82*10^-15 * p + 2.279*10^-10 ) * p - 2.2512*10^-5 ) * p + 9.72659) * p) / g

    print(depth_m)
}

```


```{r}
depth_conversion(latitude = 53.9280, p = 75)
```

